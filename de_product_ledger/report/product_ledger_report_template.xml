<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="de_product_ledger_pdf_report">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <div class="page">
                    <div class="oe_structure"/>
                    <div class="text-left">
                    <h3 class="text-center">Product Ledger </h3>
                    <!--<span t-esc="data['product_id']"/>-->
                    <t t-foreach="request.env['product.product'].search([('id', '=', data['product_id'])])" t-as="prd">
                        <h4><span t-field="prd.product_tmpl_id.name"/></h4>
                    </t>
                        <p>From Date: <span t-esc="data['start_date']" t-options="{'widget': 'date'}" />  To Date: <span t-esc="data['end_date']" t-options="{'widget': 'date'}" /></p>
                    </div>
                </div>
                <table class="table table-condensed" name="stock_expiry_table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Ref.</th>
                            <th>Lot/Serial</th>
                            <th>In Qty</th>
                            <th>Out Qty</th>
                            <th>On Hand</th>
                        </tr>
                    </thead>
                    <tbody>

                         <t t-set="rb" t-value="0"/>
                        <tr t-foreach="openstk" t-as="o" style="border-bottom:1px solid #000;">
                                <td colspan="5" class="text-left" >Opening Stock</td>
                                <td><span t-esc="o['open_stk']"/></td>
                            <t t-if="o['open_stk']">
                            <t t-set="rb" t-value="rb + o['open_stk']"/>
                            </t>
                        </tr>
                       <tr t-foreach="dat" t-as="d" style="border-bottom:1px solid #000;">
                            <t t-set="rb" t-value="rb + d['in_qty'] - d['out_qty']"/>
                                <td><span t-esc="d['date']" t-options="{'widget': 'datetime'}" /></td>
                                <td><span t-esc="d['reference']"/></td>
                                <td><span t-esc="d['lot']"/></td>
                                <td><span t-esc="d['in_qty']"/></td>
                                <td><span t-esc="d['out_qty']"/></td>
                                <td><span t-esc="rb"/></td>

                        </tr>
                        <tr style="border-top:1px solid #000;">
                                <td colspan="5" class="text-left">Closing Stock</td>
                                <td><span t-esc="rb"/></td>
                        </tr>
                    </tbody>
                  </table>
            </t>
        </t>
    </template>
</odoo>