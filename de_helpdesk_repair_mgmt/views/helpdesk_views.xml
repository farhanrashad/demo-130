<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="action_diagnosys_form" model="ir.actions.act_window">
        <field name="name">Create a Diagnosys</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">project.task</field>
        <field name="view_mode">form</field>
        <field name="target">current</field>
    </record>
    
    <record id="action_workorder_form" model="ir.actions.act_window">
        <field name="name">Create a Work Order</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">project.task</field>
        <field name="view_mode">form</field>
        <field name="target">current</field>
    </record>

    <record id="view_helpdesk_ticket_form_inherit" model="ir.ui.view">
        <field name='name'>view.helpdesk.ticket.form.inherit</field>
        <field name="model">helpdesk.ticket</field>
        <field name="inherit_id" ref="de_helpdesk.ticket_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//header" position="inside">
                <button name="%(action_diagnosys_form)d" type="action" class="oe_highlight"
                    groups="de_helpdesk.group_helpdesk_user"
                    string="Create Product Diagnosys" context="{'default_name':name + '(' + number + '-' + 'Diagnosys)','default_partner_id': partner_id, 'default_ticket_id': id, 'default_project_id':project_id, 'default_company_id': company_id,'default_is_diagnosys':True}" attrs="{'invisible': [('closed', '=', True)]}"/>
                
                <button name="%(action_workorder_form)d" type="action" class="oe_highlight"
                    groups="de_helpdesk.group_helpdesk_user"
                    string="Create Work Order" context="{'default_name':name + '(' + number + '-' + 'Work Order)','default_partner_id': partner_id, 'default_ticket_id': id, 'default_project_id':project_id,'default_company_id': company_id,'default_is_workorder':True}" attrs="{'invisible': [('closed', '=', True)]}"/>
                
            </xpath>
            
            <div class="oe_button_box" position="inside">
                <button class="oe_stat_button" name="action_view_diagnosys" icon="fa-wrench" type="object" attrs="{'invisible': [('diagnosys_count', '=', 0)]}">
                    <field name="diagnosys_count" string="Diagnosys" widget="statinfo"/>
                </button>
                
                <button class="oe_stat_button" name="action_view_workorder" icon="fa-wrench" type="object" attrs="{'invisible': [('workorder_count', '=', 0)]}">
                    <field name="workorder_count" string="Work Orders" widget="statinfo"/>
                </button>
                
            </div>
            <xpath expr="//group/group[1]" position="inside">
                <field name='project_id'/>
            </xpath>
            <xpath expr="//field[@name='partner_email']" position="after">
                <separator colspan="2" class="mt16"/>
                <field name='sale_id'/>
                <field name='product_id'/>
            </xpath>
            <!--
            <xpath expr="//group" position="after">
                <group>
                    <group string="Product Information">
                        <field name="product_id" />
                        <field name="product_uom_id" />
                        <field name="product_uom_qty" />
                        <field name="product_uom_category_id" />
                    </group>
                   
                </group>
            </xpath>
-->
        </field>
    </record>

</odoo>
